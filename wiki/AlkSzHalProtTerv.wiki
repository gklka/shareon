#summary Alkalmazási szintű hálózati protokoll tervezése
#sidebar TableOfContents

= Feladat =

Az első feladat egy alkalmazási szintű hálózati protokoll tervezése volt:<br>
 * kísérleti fájlcserélő rendszer protokolljának meghatározása<br>
 * központosított átfedő létrehozása<br>
  * központi kiszolgálón nyilvántartva az egyes ügyfelek által megosztott fájlok<br>
  * fájlcsere közvetlenül történik az ügyfelek között<br>
  * Napster jellegű átfedő rendszer<br>


= A protokoll =

Egy, a Napster program protokolljához rendkívül hasonló protokollt terveztünk meg. Ennek a protokollnak a működése a következő pontokat foglalja magában:
 # A fájlokat a kliensek (továbbiakban peer-ek) osztják meg, egyik sem található meg közvetlenül a szerveren.
 # A megosztott fájlokat a központi kiszolgáló tartja nyilván egy SQL adatbázisban.
 # A peer-ek bejelentkeznek a szerverre, majd ezután elkezdhetik megosztani az általuk birtokolt tartalmakat, melyeket a szerver rögzít.
 # Amennyiben kérés érkezik a szerverhez, az megkeresi a keresett fájlt az adatbázisban, és válaszol a kereső peer-nek az eredménnyel / eredményekkel. A letöltés ezt követően a peer-ek között zajlik(lásd 1. ábra).
 # Lehetőség van egy állományt szerver nélkül is letölteni, amennyiben a letöltő peer rendelkezik a letöltendő fájl elérési információjával(lásd 2. ábra).

A protokoll kidolgozásával bővebben a P2PHalozat wikioldal foglalkozik.

http://shareon.googlecode.com/files/ShareOn%20file%20protocol_sm.png
 1. ábra: Letöltés a szerver segítségével

http://shareon.googlecode.com/files/ShareOn-protocol_sm.png
 2. ábra: Közvetlen letöltés

= A központosított átfedő =

A feladatban létrehozott központosított átfedő egy !MySQL alapú alkalmazás. A !MySQL adatbázisban kerülnek nyilvántartásra a peer-ek által megosztott fájlok. Az adatbázis az EET tanszék Turul nevű gazdagépén található, itt fog majd futni a szerver alkalmazás is.
A szerver alkalmazás folyamatos kapcsolatban van az adatbázissal, tartalmát folyamatosan karbantartja. Regisztrálja a peer-ek feltöltéseit, valamint szükség esetén eltávolítja azokat. A szerver két összetevőből áll: egy szerver programból; valamint egy PHP kódból amely a webes felület megjelenítéséért felelős.

Az adatbázisban egy "shares" nevű tábla szolgál a peer-ek megosztásainak 
nyilvántartására, mely a következő sorokból épül fel:

{{{
 PRIMARY KEY id (INTEGER) - [auto increase]
 file (VARCHAR 255)
 hash (VARCHAR 128)
 ip (VARCHAR 15) - [default = 127.0.0.1]
}}}

A peer-ek a szerver adatbázisából lekérdezve kezdhetik meg a letöltést.

A központosított átfedő által használt MySQL adatbázishoz a szerver két összetevője a következőképp férhet hozzá:
http://shareon.googlecode.com/files/SQL-PHP%2CServer%20kommunikacio_sm.png